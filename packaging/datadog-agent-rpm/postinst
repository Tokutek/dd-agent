# start
chown -R dd-agent /etc/dd-agent/
chown -R dd-agent /var/log/datadog/
# Install the virtual env and the dependencies
python /usr/share/datadog/agent/libs/virtualenv.py --system-site-packages --no-pip --no-setuptools /usr/share/datadog/agent/venv
/usr/share/datadog/agent/venv/bin/python /usr/share/datadog/agent/libs/ez_setup.py
/usr/share/datadog/agent/venv/bin/python /usr/share/datadog/agent/libs/get-pip.py
/usr/share/datadog/agent/venv/bin/python /usr/share/datadog/agent/venv/bin/pip install tornado==3.1.1
/usr/share/datadog/agent/venv/bin/python /usr/share/datadog/agent/venv/bin/pip install supervisor==3.0
chkconfig --add datadog-agent

/etc/init.d/datadog-agent restart
RETVAL=$?
if [ $RETVAL -ne 0 ]; then
    if [ $RETVAL -eq 3 ]; then
        # No datadog.conf file is present. The user is probably following
        # the step-by-step instructions and will add the config file next.
        exit 0
    else
        exit $RETVAL
    fi
fi

exit 0
